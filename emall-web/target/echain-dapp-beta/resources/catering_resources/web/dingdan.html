
<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="GBK" />
    <link rel="stylesheet" type="text/css" href="css/wei_dialog.css" media="all" />
<link rel="stylesheet" type="text/css" href="css/wei_canyin.css" media="all" />
<script type="text/javascript" src="js/jQuery.js"></script>
<script type="text/javascript" src="js/wei_webapp_v2_common.js"></script>
<title>我的订单</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
</head>
<body id="page_intelOrder" class="myOrderCon">
    <script>
$(document).ready(function(){
    var min_height = $(document).height() - 80;
    $("#container").css({"min-height":min_height});
});
</script>
<div class="container">
    <header id="container">
        <div>
            <select class="select_orderType" onchange="orderList(this);">
                <option value="0">未付款，未就餐</option>
                <option value="1">已付款，未就餐</option>
                <option value="2">已付款，已就餐</option>
            </select>
        </div>
        <div style="padding:10px 0;" id='list'>
                            暂无订单
                    </div>
    </header>

        <script>
            var footer = document.getElementById("footer_menu");
            var evtObj = {
                handleEvent: function(evt){
                    if("A" == evt.target.tagName){
                        evt.target.classList.toggle("on");
                    }
                }
            }
//            footer.addEventListener("touchstart", evtObj, false);
//            footer.addEventListener("touchend", evtObj, false);

        </script>
</div>
<div id="footer_menu" class="footer footer_menu">
    <ul class="clear" style="position: inherit;">
        <li><a href="/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_1"></span><label>智能选餐</label></a></li>
                    <li><a href="/sps/webfood/DishesList?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5"  ><span class="icons icons_2"></span><label>点菜</label></a></li>
                <li><a class="onactive" href="javascript:void(0);" ><span class="icons icons_3"></span><label>我的订单</label></a></li>
        <li><a href="/sps/webfood/like?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_4"></span><label>我喜欢</label></a></li>
        <li><a href="javascript:void(0);" id="my_menu"><span class="icons icons_5"><label id="num" class="num">1</label></span></a></li>
    </ul>
</div>
<script>
    window.selected = {
            total:0,
            dishes:{}
        };
function orderList(thi){
    var val = $(thi).val();
    $.ajax({
        url:'http://14924.m.weimob.com/sps/webfood/doMyorder'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5',
        data:{'val':val},
        type:'POST',
        dataType:'html',
        cache:false,
        beforeSend:function(){
            MLoading.show('加载中');
        },
        success:function(msgObj){
            MLoading.hide();
            $("#list").html(msgObj);
        }
    });
} 

function addToMenu(){
            var params = '[';
            for(var key in window.selected.dishes){
                params += '{"dishes_id":'+ key + ",",
                params += '"price":'+ window.selected.dishes[key].price + ",",
                params += '"nums":'+ window.selected.dishes[key].num + "},"
            }
            params = params.replace(/,$/, "");
            params += ']';

            $.ajax({
                'url':'http://14924.m.weimob.com/sps/webfood/AddOrder'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5',
                'data':{'order':params},
                'type':'POST',
                'async':'false',
                'success':function(db){
                    location.href='http://14924.m.weimob.com/sps/webfood/MyMenuList'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5';
                }
            });

        }
</script>
<script>
    $(document).ready(function(){
        $('#my_menu').click(function(){
            addToMenu();

	});
        
    });

</script>
<script>
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        WeixinJSBridge.call('hideToolbar');
    });
</script>
<script>
    $(document).ready(function(){
        $(".confirm_order").click(function(){
            var url = $(this).attr("url");
            var pay_type = $(this).attr("pc_type");
            var pay = $(this).attr("val");
            var o_id = $(this).attr("o_id");
            $.ajax({
                'url':url,
                'type':'POST',
                'data':{"o_id":o_id,"pay_type":pay_type},
                beforeSend:function(){
                    MLoading.show('加载中');
                },
                'success':function(data){
                    if(pay == 'alipay'){
                        window.location.href=data;
                    }else{
                        alert("订单支付成功");
                    }
                    $('#confirm_order').hide();
                }
            });

        });
    });

</script>
</body>
</html>
