
<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="GBK" />
    <link rel="stylesheet" type="text/css" href="css/wei_canyin.css" media="all" />
<link rel="stylesheet" type="text/css" href="css/wei_dialog.css" media="all" />
<script type="text/javascript" src="js/jQuery.js"></script>
<script type="text/javascript" src="js/wei_webapp_v2_common.js"></script>
<title>南平小南国---我喜欢</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
</head>
<body id="page_allMenu">
    
<div class="center">
    <section id="infoSection" style="float:none;width:100%;">
        <article>
            <!--div class="h2">推荐菜</div-->
            
                <div id="pInfo">
                                        <dl id="list_5660" dunitname="例" dsubcount="1" dishid="5660" dname="心形雪里红" dtaste="" ddescribe="心形雪里红" dprice="13" dishot="" dspecialprice="13" disspecial="1" onclick="selectOne(this, '30092', '13');"> 
                        <dt><h3>心形雪里红</h3></dt>                    
                        <dd>
                            <a href="javascript:void(0)" class="dataIn" onclick="showImgDetail(this);event.stopPropagation();">
                                <img src="http://img.weimob.com/static/98/e6/6d/image/20131123/20131123004413_54820.jpg" alt="" title="">
                                <span style="font-size:10px;"></span></a>
                        </dd>
                        <dd>
                            <em>13元/例</em>
                        </dd> 
                        <input type="checkbox" class="favourite" value="5660" checked onclick="favourite(this, event);">
                                                <button shopinfo="" class="selectBtn choose  unchoose"></button>
                                            </dl>
                                        <dl id="list_5661" dunitname="例" dsubcount="1" dishid="5661" dname="花雕醉蟹钳" dtaste="" ddescribe="花雕醉蟹钳" dprice="18" dishot="" dspecialprice="18" disspecial="1" onclick="selectOne(this, '30093', '18');"> 
                        <dt><h3>花雕醉蟹钳</h3></dt>                    
                        <dd>
                            <a href="javascript:void(0)" class="dataIn" onclick="showImgDetail(this);event.stopPropagation();">
                                <img src="http://img.weimob.com/static/98/e6/6d/image/20131123/20131123004851_33220.jpg" alt="" title="">
                                <span style="font-size:10px;"></span></a>
                        </dd>
                        <dd>
                            <em>18元/例</em>
                        </dd> 
                        <input type="checkbox" class="favourite" value="5661" checked onclick="favourite(this, event);">
                                                <button shopinfo="" class="selectBtn choose  unchoose"></button>
                                            </dl>
                                    </div>
        </article>
    </section>
    <div id="footer_menu" class="footer footer_menu">
            <ul class="clear">
                <li><a href="/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_1"></span><label>智能选餐</label></a></li>
                                <li><a href="/sps/webfood/DishesList?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5"  ><span class="icons icons_2"></span><label>点菜</label></a></li>
                                <li><a href="/sps/webfood/myorder?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_3"></span><label>我的订单</label></a></li>
                <li><a class="onactive" href="javascript:void(0);" ><span class="icons icons_4"></span><label>我喜欢</label></a></li>
                <li><a href="javascript:void(0);" id="my_menu"><span class="icons icons_5"><label id="num" class="num">1</label></span></a></li>
            </ul>
        </div>
        <script>
            var footer = document.getElementById("footer_menu");
            var evtObj = {
                handleEvent: function(evt){
                    if("A" == evt.target.tagName){
                        evt.target.classList.toggle("on");
                    }
                }
            }
            footer.addEventListener("touchstart", evtObj, false);
            footer.addEventListener("touchend", evtObj, false);
        </script>
    </div>
    <script type="text/javascript">
        window.selected = {
            total:0,
            dishes:{}
        };
        var cardid = '3414907165';
        var view_const_dish_SPECIAL_PRICE_YES = '2';
        var view_const_dish_HOT_YES = '2';

        function setHeight(){
            var  cHeight;
            cHeight = document.documentElement.clientHeight;
            cHeight = cHeight +"px"
            document.getElementById("navBar").style.height =  cHeight;
            document.getElementById("infoSection").style.height =  cHeight;
        }


        function getAllList(){
            var params = {
            }
            MLoading.show('加载中');
             _doAjax('/sps/webfood/GetLikeList?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5', 'POST', params, function(res) {
                MLoading.hide();
                window.res = res;
                if(res && res.length){
                    switchList();
                    var navBar = document.getElementById("navBar");
                    var TPL = '<dd categoryid="{id}" class="{selectedClass}" onclick="switchList({id});">{name}</dd>';
                    (function(){
                       var dds_HTML = iTemplate.makeList(TPL, res, function(k,v){
                            return {
                                selectedClass: 0 ==k?"active":""
                            }
                       });
                       navBar.innerHTML = "<dl>" + dds_HTML + "</dl>";
                    })();
                }
            });
        }
        //
        function switchList(id){
            var ai = {};
            if(id){
                var dds = _qAll('#navBar dd');
                for(var i = 0;ci=window.res[i]; i++){
                    dds[i].className = null;
                    if(id == ci.id){
                        ai = ci;
                        dds[i].className = "active";
                    }
                }
            }else{
                ai = window.res[0];
            }
//            alert(id);return false;
            var checkHtml = '';
            var TPL = '<dl dunitname="例" dsubcount="1" dishid="{id}" dname="{name}" dtaste="" ddescribe="{note}" dprice="{price}" dishot="{tag_name}" dspecialprice="{discount_price}" disspecial="1" onclick="selectOne(this, {id}, {price});">\
                    <dt><h3>{name}</h3></dt>\
                    <dd>\
                        <a href="javascript:void(0)" class="dataIn" onclick="showImgDetail(this);event.stopPropagation();">\
                            <img src="{pic}" alt="" title="">';

					TPL += '<span style="font-size:10px;">{tag_name}</span>';
                                        
                                        
                 TPL +='</a>\
                    </dd>\
                    <dd>\
                        <em>{price}元/例</em>\
                    </dd>\
                    <!--dd class="dpNum">961人点过</dd-->\
                    <input type="checkbox" class="favourite" value="{id}" {check} onclick="favourite(this, event);">\
                    <button shopinfo="" class="{curState}"></button>\
                </dl>';
            document.getElementById("pInfo").innerHTML = iTemplate.makeList(TPL, ai.dishes, function(k,v){
				if(v.discount_price){
					v.price = v.discount_price;
				}
                return {
                    curState: (v.id in window.selected.dishes)? "selectBtn choose choosen":"selectBtn choose  unchoose",
                    check : (v.check == '1') ? "checked" : ''
                }
            });
        }
        //show img detail
        function showImgDetail(thi){
            var parentDl = thi.parentNode.parentNode;
            var childImg = thi.childNodes[0]
            if(childImg.nodeType == 3){
                childImg = thi.childNodes[1];
            }

            popPic(childImg.src,
                    parentDl.getAttribute('dname'),
                    parentDl.getAttribute('dprice') + '元/' + parentDl.getAttribute('dunitName'),
                    parentDl.getAttribute('dIsSpecial'),
                    parentDl.getAttribute('dSpecialPrice') + '元/' + parentDl.getAttribute('dunitName'),
                    parentDl.getAttribute('dsubCount'),
                    parentDl.getAttribute('dtaste'),
                    parentDl.getAttribute('ddescribe'),
                    parentDl.getAttribute('dishot')
                );
        }
        //

       function selectOne(container, dishid, price) {
            var btn = container.querySelectorAll("button")[0];
            if (btn.className.indexOf("choosen")>-1) {
                _removeClass(btn, 'choosen');
                _addClass(btn, 'unchoose');
                //unselected
                delete window.selected.dishes[dishid];
                window.selected.total -=1;
            } else {
                _removeClass(btn, 'unchoose');
                _addClass(btn, 'choosen');
                //selected
                window.selected.dishes[dishid] = {
                    price:price,
                    num:1
                }
                window.selected.total +=1;

            }
            if(!("origTotal" in window.selected)){
                window.selected.origTotal = parseInt(_q(".footer_menu .num").innerHTML);
            }
            _q(".footer_menu .num").innerHTML = window.selected.origTotal + window.selected.total;
            console.log(window.selected);
        }
        //
        function addToMenu(){
            var params = '[';
            for(var key in window.selected.dishes){
                params += '{"dishes_id":'+ key + ",",
                params += '"price":'+ window.selected.dishes[key].price + ",",
                params += '"nums":'+ window.selected.dishes[key].num + "},"
            }
            params = params.replace(/,$/, "");
            params += ']';

            $.ajax({
                'url':'/sps/webfood/AddOrder'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5',
                'data':{'order':params},
                'type':'POST',
                'async':'false',
                'success':function(db){
                    location.href='/sps/webfood/MyMenuList'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5';
                }
            });

        }

        //后台可自行扩展参数
        //调用自定义弹层
        function popPic(imgUrl,title,price, isSpecial, specialPrice, people,teast,assess,isHot){
            var _title = title,
                _price = price,
                _people = null;//people,
                _teast = teast,
                _assess = assess;

                var hotHtml = '<b>'+isHot+'</b>';
                _tmpHtml = "<div class='content'>"+hotHtml+"<img src='"+imgUrl+"' alt='' title=''><h2>"+_title;

                 if (isSpecial == view_const_dish_SPECIAL_PRICE_YES) {
                     _tmpHtml += "<i>"+specialPrice+"</i><del>"+_price+"</del>";
                 } else {
                     _tmpHtml += "<i>"+_price+"</i>";
                 }

                if (_people) {
                    _tmpHtml += "<span>"+_people+"人点过</span>";
                }
                _tmpHtml += "</h2>";

                if (_teast) {
                    _tmpHtml += "<h3>口味："+_teast+"</h3>";
                }

                if (_assess) {
                    _tmpHtml += "<p>"+_assess+"</p>";
                }

                _tmpHtml += '</div>';
            MDialog.popupCustom(_tmpHtml,true,true);
        }

        window.addEventListener("DOMContentLoaded", function(){
            //getAllList();
            setHeight();
        }, false);
        window.onresize = function(){setHeight();}
        function favourite(thi, evt){
            evt.stopPropagation();
            var checkeds = '';
            if($(thi).is(':checked')){
                checkeds = '1';
            }else{
                checkeds = '0';
            }
            MDialog.confirm(
                '', '您确定要从喜欢栏目中移除？', null,
                '确定', function() {
                    
                    var id = $(thi).val();
                    var check = '';
                    if($(thi).is(':checked')){
                        check = '1';
                    }else{
                        check = '0';
                    }
                    $.ajax({
                        url:'/sps/webfood/doLike'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5',
                        data:{'id':id,'check':check},
                        type:'POST',
                        dataType:'json',
                        cache:false,
                        beforeSend:function(){
                            MLoading.show('加载中');
                        },
                        success:function(msgObj){
                            MLoading.hide();
                            if(msgObj.status == '1'){
                                $("#list_"+id).remove();
                            }else{
                                return false;
                            }
                        }
                    });

                }, null,
                '取消', function(){thi.checked = true;}, null,
                    null, true, true
                );
        }
    </script>

<script>
    $(document).ready(function(){
        $('#my_menu').click(function(){
            addToMenu();

	    });
        
    });

</script>
<script>
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        WeixinJSBridge.call('hideToolbar');
    });
</script>
	<script>
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			
			window.shareData = {
				"imgUrl": "http://img.weimob.com/static/cb/24/d5/image/20131104/20131104203509_59441.jpg",
				"timeLineLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
				"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
				"weiboLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
				"tTitle": "南平小南国 可以收藏自己喜欢的菜品了，小伙伴们快来体验吧！",
				"tContent": "南平小南国",
				"fTitle": "南平小南国 可以收藏自己喜欢的菜品了，小伙伴们快来体验吧！",
				"fContent": "南平小南国",
				"wContent": "南平小南国"
			};

			// 发送给好友
			WeixinJSBridge.on('menu:share:appmessage', function (argv) {
				WeixinJSBridge.invoke('sendAppMessage', {
					"img_url": window.shareData.imgUrl,
					"img_width": "640",
					"img_height": "640",
					"link": window.shareData.sendFriendLink,
					"desc": window.shareData.fContent,
					"title": window.shareData.fTitle
				}, function (res) {
					_report('send_msg', '111111');
				})
			});

			// 分享到朋友圈
			WeixinJSBridge.on('menu:share:timeline', function (argv) {
				WeixinJSBridge.invoke('shareTimeline', {
					"img_url": window.shareData.imgUrl,
					"img_width": "640",
					"img_height": "640",
					"link": window.shareData.timeLineLink,
					"desc": window.shareData.tContent,
					"title": window.shareData.tTitle
				}, function (res) {
					_report('timeline', res.err_msg);
				});
			});

			// 分享到微博
			WeixinJSBridge.on('menu:share:weibo', function (argv) {
				WeixinJSBridge.invoke('shareWeibo', {
					"content": window.shareData.wContent,
					"url": window.shareData.weiboLink
				}, function (res) {
					_report('weibo', res.err_msg);
				});
			});
		}, false)
	</script>
<script type="text/javascript">
window.shareData = {
	"imgUrl": "http://img.weimob.com/static/cb/24/d5/image/20131104/20131104203509_59441.jpg", 
	"timeLineLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
	"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
	"weiboLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=17fc52d40c672e92a74e231240172ad5",
	"tTitle": "南平小南国 可以收藏自己喜欢的菜品了，小伙伴们快来体验吧！",
	"tContent": "南平小南国",
	"fTitle": "南平小南国 可以收藏自己喜欢的菜品了，小伙伴们快来体验吧！",
	"fContent": "南平小南国",
	"wContent": "南平小南国" 
};
</script></body>
<script>
window.addEventListener("DOMContentLoaded", function(){
            getRecommendList();
        }, false);
</script>
<script type="text/javascript">
(function() {
	var wtj = document.createElement('script'); wtj.type = 'text/javascript'; wtj.async = true;
	wtj.src = 'http://tj.weimob.com/wtj.js?url=' + encodeURIComponent(location.href);
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wtj, s);
})();
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fd80741dd59de91e1846b2add2c0ad2a2' type='text/javascript'%3E%3C/script%3E"));
function weimobAfterShare(shareFromWechatId,sendFriendLink,shareToPlatform){
	var int_tmp_pid = ;
	var wmShare = document.createElement('script'); wmShare.type = 'text/javascript'; wmShare.async = true;
    wmShare.src = 'http://tj.weimob.com/api-share.js?fromWechatId=' + shareFromWechatId + '&shareToPlatform=';
	wmShare.src += shareToPlatform + '&pid=&sendFriendLink=' + encodeURIComponent(sendFriendLink);
    var stj = document.getElementsByTagName('script')[0]; stj.parentNode.insertBefore(wmShare, stj);
	if(23260 == int_tmp_pid){
		//alert(wmShare.src);
	}
}

/**
 * 默认分享出去的数据
 *
 */
function getShareImageUrl(){
	var share_imgurl = "";
	if("" == share_imgurl){
		var shareImgObj = document.getElementsByClassName("shareImgUrl")[0];
		if('undefined' != typeof(shareImgObj)){
			share_imgurl = shareImgObj.src;
		}
	}
	return window.shareData.imgUrl || share_imgurl;
}

window.shareData = window.shareData || {
		"timeLineLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"weiboLink": "http://14924.m.weimob.com/sps/webfood/like?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"tTitle": document.title,
	"tContent": document.title,
	"fTitle": document.title,
	"fContent": document.title,
	"wContent": document.title
}
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
	// 发送给好友
	WeixinJSBridge.on('menu:share:appmessage', function (argv) {
		WeixinJSBridge.invoke('sendAppMessage', { 
			"img_url": getShareImageUrl(),
			"img_width": "640",
			"img_height": "640",
			"link": window.shareData.sendFriendLink,
			"desc": window.shareData.fContent,
			"title": window.shareData.fTitle
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.sendFriendLink,'appmessage');
			_report('send_msg', res.err_msg);
		})
	});

	// 分享到朋友圈
	WeixinJSBridge.on('menu:share:timeline', function (argv) {
		WeixinJSBridge.invoke('shareTimeline', {
			"img_url": getShareImageUrl(),
			"img_width": "640",
			"img_height": "640",
			"link": window.shareData.timeLineLink,
			"desc": window.shareData.tContent,
			"title": window.shareData.tTitle
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.timeLineLink,'timeline');
			_report('timeline', res.err_msg);
		});
	});

	// 分享到微博
	WeixinJSBridge.on('menu:share:weibo', function (argv) {
		WeixinJSBridge.invoke('shareWeibo', {
			"content": window.shareData.wContent,
			"url": window.shareData.weiboLink
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.weiboLink,'weibo');
			_report('weibo', res.err_msg);
		});
	});
}, false);
</script>
</html>
