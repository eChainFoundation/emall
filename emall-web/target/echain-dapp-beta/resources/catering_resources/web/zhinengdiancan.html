
<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="GBK" />
    <link rel="stylesheet" type="text/css" href="css/wei_canyin.css" media="all" />
<script type="text/javascript" src="js/jQuery.js"></script>
<script type="text/javascript" src="js/wei_webapp_v2_common.js"></script>
<title>南平小南国</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
</head>
<body id="page_count">
    
    <div class="center main">
        <section>
            <ol>
                
            </ol>
        </section>
    </div>
    <div class="notice">
        <b>请选择您的用餐人数</b>
    </div>
        <div class="center">
		<form id="re-location" action="/sps/webfood/CompoDishesList?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" method="post">
			<input type="hidden" name="combo_nums" value=""/>
		</form>
        <a class="order" href="#" onclick="return doSelected()" id="order"><span>开始点菜</span></a>
    </div>
<div id="footer_menu" class="footer footer_menu">
            <ul class="clear">
                <li style="width: 60px;"><a class="onactive" href="/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_1"></span><label>智能选餐</label></a></li>
                                <li style="width: 60px;"><a href="/sps/webfood/DishesList?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5"  ><span class="icons icons_2"></span><label>点菜</label></a></li>
                                <li style="width: 60px;"><a href="/sps/webfood/myorder?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_3"></span><label>我的订单</label></a></li>
                <li style="width: 60px;"><a href="/sps/webfood/like?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5" ><span class="icons icons_4"></span><label>我喜欢</label></a></li>
                <li style="width: 60px;"><a href="javascript:void(0);" id="my_menu"><span class="icons icons_5"><label id="num" class="num">1</label></span></a></li>
            </ul>
        </div>
        <script>
            var footer = document.getElementById("footer_menu");
            var evtObj = {
                handleEvent: function(evt){
                    if("A" == evt.target.tagName){
                        evt.target.classList.toggle("on");
                    }
                }
            }
            footer.addEventListener("touchstart", evtObj, false);
            footer.addEventListener("touchend", evtObj, false);
        </script>
        
    <script>
        window.selected = {
            total:0,
            dishes:{}
        };
        var counts = 1;
        var cardid = "3414907165";
        if(counts > 1){
            var nums = new Array();
        }else{
            var nums = new Array("");
        }
        
        var _selectedCount = 0; //选择好的人数会同步到这个变量里
        function SliderChooser(config){ var container = _q(config.containerContext), inner = _q(config.innerContext, container), nums = config.nums, itemW = config.itemWidth, curr = 1, w = container.clientWidth, drag_start = {time: 0, left: 0, top: 0, x: 0, y: 0, lx: 0, ly: 0}, drag_end = {left: 0}, directionLocked = null, time = function(){ return (new Date).getTime(); }, getP = function(e){ var t = e.touches[0], c = e.currentTarget.parentNode, r = c.parentNode.getClientRects()[0]; return { x: t.pageX-r.left, y: t.pageY-r.top, px: t.pageX, py: t.pageY, cx: t.clientX, cy: t.clientY, sx: t.screenX, sy: t.screenY }; }, getLeft = function(dom){ return parseFloat( /\((\-?[\.\d]+)px/.exec( dom.style[_vendor + 'Transform'] )[1] ); }, setCurr = function(idx) { curr = idx; _forEach(_qAll(config.itemContext, inner), function(li, liIdx){ _removeClass(li, config.currentStyleClass); if (idx == liIdx){ _addClass(li, config.currentStyleClass); } }); }, doTransition = function(value, tweenMode) { var d = tweenMode? /*as idx*/-value*itemW : value, s = tweenMode ? 6.18 * 4 * .01 : 0; inner.style[_vendor + 'TransitionDuration'] = s + 's'; inner.style[_vendor + 'Transform'] = _trnOpen + d + 'px,0' + _trnClose; }, e_ts = function(e) /*touchstart*/ { if (!_touchSupport) e.preventDefault(); directionLocked = null; var p1 = getP(e), p2 = { x: drag_end.left*1, y: inner.getClientRects()[0].top }; drag_start = { time: time(), left: p2.x, top: p2.y, x: parseInt(p2.x - p1.x), y: parseInt(p2.y - p1.y), lx: e.touches[0].clientX, ly: e.touches[0].clientY, point: p1 }; e.currentTarget.addEventListener("touchmove", e_tm); e.currentTarget.addEventListener("touchend", e_te); e.currentTarget.addEventListener("touchcancel", e_te); }, e_tm = function(e) /*touchmove*/ { if (!_touchSupport) e.preventDefault(); var p = getP(e), c = e.currentTarget.parentNode, v = drag_start.x + p.x; /*横纵拖动互不干扰*/ var absDistX, absDistY, deltaX = e.touches[0].pageX - drag_start.point.px, deltaY = e.touches[0].pageY - drag_start.point.py; if (directionLocked === "y") { return } else { if (directionLocked === "x") { e.preventDefault() } else { absDistX = Math.abs(deltaX); absDistY = Math.abs(deltaY); if (absDistX < 4) { return } if (absDistY > absDistX * 0.58) { directionLocked = "y"; return } else { e.preventDefault(); directionLocked = "x"; } } } doTransition( v ); if (MData(c, 'touching') === undefined || MData(c, 'touching')*1 != 1) MData(c, 'touching', 1); }, e_te = function(e) /*touchend*/ { if (!_touchSupport)    e.preventDefault(); e.currentTarget.removeEventListener("touchmove", e_tm); e.currentTarget.removeEventListener("touchend", e_te); e.currentTarget.removeEventListener("touchcancel", e_te); var c = e.currentTarget.parentNode; MData(c, 'touching', 0); try{ drag_end.left = getLeft(c); }catch(ex){} var idx = curr, p2 = { x: drag_end.left, y: c.getClientRects()[0].top }, tTime = time() - drag_start.time, tDis = p2.x - drag_start.left, shortDis = Math.abs(tDis)<5, longTime = tTime > 300; if (!longTime && !shortDis){ /*快速拖动*/ if (tDis < 0) /*left*/ idx++; else /*right*/ idx--; }else{ /*一般拖动*/ if ( Math.abs(tDis) > .5*itemW ){ var d1 = Math.abs(Math.round(tDis/itemW)); if( tDis < 0 ) idx += d1; else idx -= d1; } } if (idx<1) idx = 1; if (idx>=nums.length-2) idx = nums.length-2; doTransition(idx-1, true); drag_end.left = getLeft(c); setCurr(idx); if ('callback' in config && !!config.callback){ config.callback.call(null, curr-1); } }; nums.unshift(-1); nums.push(-1); _forEach(nums, function(n,idx,arr){ inner.insertAdjacentHTML('beforeEnd', '<'+config.itemContext+'>'+n+'</'+config.itemContext+'>'); var li = _q(config.itemContext+':last-of-type', inner); if (idx==0 || idx == arr.length-1){ _addClass(li, 'sider'); return; } li.addEventListener("touchstart", e_ts); li = null; }); inner.style.width = itemW * nums.length + 'px'; setCurr(1); };
        function scCallback(currIdx){
            _forEach(_qAll('section li'), function(li){
                _removeClass(li, 'left');
                _removeClass(li, 'right');
            });
            var l = _q('section li:nth-of-type('+(currIdx+1)+')'),
                r = _q('section li:nth-of-type('+(currIdx+3)+')');
            _addClass(l, 'left');
            _addClass(r, 'right');
            l = null;
            r = null;
            _selectedCount = parseInt(_q('section li:nth-of-type('+(currIdx+2)+')').innerHTML);
        }
        _onPageLoaded(function(){
            _q('body').scrollTop = -1; 
            window.scrollTo(0,-1); 
            _q('body').style.height = window.innerHeight + 'px'; 
            var obtn = _q('.order'); 
            obtn.style.marginTop = '80px'; //(window.innerHeight - 280 - 75) + 'px';
            
            SliderChooser({
                nums: nums,
                containerContext: 'section',
                innerContext: 'ol',
                itemContext: 'li',
                itemWidth: 106,
                currentStyleClass: 'curr',
                callback: scCallback
            });
            scCallback(0);
        });
        function doSelected() {
               $('#re-location input[name="combo_nums"]').val(_selectedCount);
               $('#re-location').submit();
               return false;
        }
        
        function addToMenu(){
            var params = '[';
            for(var key in window.selected.dishes){
                params += '{"dishes_id":'+ key + ",",
                params += '"price":'+ window.selected.dishes[key].price + ",",
                params += '"nums":'+ window.selected.dishes[key].num + "},"
            }
            params = params.replace(/,$/, "");
            params += ']';

            $.ajax({
                'url':'/sps/webfood/AddOrder'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5',
                'data':{'order':params},
                'type':'POST',
                'async':'false',
                'success':function(db){
                    location.href='/sps/webfood/MyMenuList'+'?aid=14924&outletid=757&wechatid=owK7EjqYwJvdWSOf5Xt3d2r1YcQE&v=2a98a2bcec1d3cf87dc0cf4912b658f5';
                }
            });

        }

    </script>
    <script>
    $(document).ready(function(){
        $('#my_menu').click(function(){
            addToMenu();

	});
        
    });
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        WeixinJSBridge.call('hideToolbar');
    });

</script>
    	<script>
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			
			window.shareData = {
				"imgUrl": "http://img.weimob.com/static/cb/24/d5/image/20131104/20131104203509_59441.jpg",
				"timeLineLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
				"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
				"weiboLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
				"tTitle": "南平小南国 智能选餐太好用了，小伙伴们快来体验吧！",
				"tContent": "南平小南国",
				"fTitle": "南平小南国 智能选餐太好用了，小伙伴们快来体验吧！",
				"fContent": "南平小南国",
				"wContent": "南平小南国"
			};

			// 发送给好友
			WeixinJSBridge.on('menu:share:appmessage', function (argv) {
				WeixinJSBridge.invoke('sendAppMessage', {
					"img_url": window.shareData.imgUrl,
					"img_width": "640",
					"img_height": "640",
					"link": window.shareData.sendFriendLink,
					"desc": window.shareData.fContent,
					"title": window.shareData.fTitle
				}, function (res) {
					_report('send_msg', '111111');
				})
			});

			// 分享到朋友圈
			WeixinJSBridge.on('menu:share:timeline', function (argv) {
				WeixinJSBridge.invoke('shareTimeline', {
					"img_url": window.shareData.imgUrl,
					"img_width": "640",
					"img_height": "640",
					"link": window.shareData.timeLineLink,
					"desc": window.shareData.tContent,
					"title": window.shareData.tTitle
				}, function (res) {
					_report('timeline', res.err_msg);
				});
			});

			// 分享到微博
			WeixinJSBridge.on('menu:share:weibo', function (argv) {
				WeixinJSBridge.invoke('shareWeibo', {
					"content": window.shareData.wContent,
					"url": window.shareData.weiboLink
				}, function (res) {
					_report('weibo', res.err_msg);
				});
			});
		}, false)
	</script>
<script type="text/javascript">
window.shareData = {
	"imgUrl": "http://img.weimob.com/static/cb/24/d5/image/20131104/20131104203509_59441.jpg", 
	"timeLineLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
	"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
	"weiboLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5&v=9b1c5796e4502ec636f49336bf40c3dc",
	"tTitle": "南平小南国 智能选餐太好用了，小伙伴们快来体验吧！",
	"tContent": "南平小南国",
	"fTitle": "南平小南国 智能选餐太好用了，小伙伴们快来体验吧！",
	"fContent": "南平小南国",
	"wContent": "南平小南国" 
};
</script>

</body>
<script>
window.addEventListener("DOMContentLoaded", function(){
            getRecommendList();
        }, false);
</script>
<script type="text/javascript">
(function() {
	var wtj = document.createElement('script'); wtj.type = 'text/javascript'; wtj.async = true;
	wtj.src = 'http://tj.weimob.com/wtj.js?url=' + encodeURIComponent(location.href);
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wtj, s);
})();
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fd80741dd59de91e1846b2add2c0ad2a2' type='text/javascript'%3E%3C/script%3E"));
function weimobAfterShare(shareFromWechatId,sendFriendLink,shareToPlatform){
	var int_tmp_pid = ;
	var wmShare = document.createElement('script'); wmShare.type = 'text/javascript'; wmShare.async = true;
    wmShare.src = 'http://tj.weimob.com/api-share.js?fromWechatId=' + shareFromWechatId + '&shareToPlatform=';
	wmShare.src += shareToPlatform + '&pid=&sendFriendLink=' + encodeURIComponent(sendFriendLink);
    var stj = document.getElementsByTagName('script')[0]; stj.parentNode.insertBefore(wmShare, stj);
	if(23260 == int_tmp_pid){
		//alert(wmShare.src);
	}
}

/**
 * 默认分享出去的数据
 *
 */
function getShareImageUrl(){
	var share_imgurl = "";
	if("" == share_imgurl){
		var shareImgObj = document.getElementsByClassName("shareImgUrl")[0];
		if('undefined' != typeof(shareImgObj)){
			share_imgurl = shareImgObj.src;
		}
	}
	return window.shareData.imgUrl || share_imgurl;
}

window.shareData = window.shareData || {
		"timeLineLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"sendFriendLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"weiboLink": "http://14924.m.weimob.com/sps/webfood/ComboNums?aid=14924&outletid=757&wechatid=fromUsername&v=2a98a2bcec1d3cf87dc0cf4912b658f5",
	"tTitle": document.title,
	"tContent": document.title,
	"fTitle": document.title,
	"fContent": document.title,
	"wContent": document.title
}
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
	// 发送给好友
	WeixinJSBridge.on('menu:share:appmessage', function (argv) {
		WeixinJSBridge.invoke('sendAppMessage', { 
			"img_url": getShareImageUrl(),
			"img_width": "640",
			"img_height": "640",
			"link": window.shareData.sendFriendLink,
			"desc": window.shareData.fContent,
			"title": window.shareData.fTitle
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.sendFriendLink,'appmessage');
			_report('send_msg', res.err_msg);
		})
	});

	// 分享到朋友圈
	WeixinJSBridge.on('menu:share:timeline', function (argv) {
		WeixinJSBridge.invoke('shareTimeline', {
			"img_url": getShareImageUrl(),
			"img_width": "640",
			"img_height": "640",
			"link": window.shareData.timeLineLink,
			"desc": window.shareData.tContent,
			"title": window.shareData.tTitle
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.timeLineLink,'timeline');
			_report('timeline', res.err_msg);
		});
	});

	// 分享到微博
	WeixinJSBridge.on('menu:share:weibo', function (argv) {
		WeixinJSBridge.invoke('shareWeibo', {
			"content": window.shareData.wContent,
			"url": window.shareData.weiboLink
		}, function (res) {
			weimobAfterShare("owK7EjqYwJvdWSOf5Xt3d2r1YcQE",window.shareData.weiboLink,'weibo');
			_report('weibo', res.err_msg);
		});
	});
}, false);
</script>
</html>
